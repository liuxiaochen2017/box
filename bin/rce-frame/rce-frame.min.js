var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function c(t){try{s(r.next(t))}catch(e){o(e)}}function a(t){try{s(r["throw"](t))}catch(e){o(e)}}function s(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(c,a)}s((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(c=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(c=c.call(o,n[1])).done)return c;switch(o=0,c&&(n=[0,c.value]),n[0]){case 0:case 1:c=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(c=s.trys,!(c=c.length>0&&c[c.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!c||n[1]>c[0]&&n[1]<c[3])){s.label=n[1];break}if(6===n[0]&&s.label<c[1]){s.label=c[1],c=n;break}if(c&&s.label<c[2]){s.label=c[2],s.ops.push(n);break}c[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(r){n=[6,r],o=0}finally{i=c=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,c,a,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},rce;!function(t){var e=function(){function t(){this.hashCode=t._count=t._count+1}return Object.defineProperty(t,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t._count=0,t}();t.HashObject=e,__reflect(e.prototype,"rce.HashObject")}(rce||(rce={}));var rce;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.mapListeners={},t}return __extends(n,e),n.prototype.addEventListener=function(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=0);var i=this.mapListeners[t];if(!i)return void(this.mapListeners[t]=[{handle:e,context:n,priority:r}]);var o=i.some(function(t){return t.handle===e&&t.context===n});if(!o){for(var c={handle:e,context:n,priority:r},a=i.length-1;a>=0;a-=1){var s=i[a];if(s.priority>=c.priority)return void i.splice(a,0,c)}i.unshift(c)}},n.prototype.removeEventListener=function(t,e,n){var r=this.mapListeners[t];if(r){for(var i=r.length-1;i>=0;i-=1){var o=r[i];if(o.handle===e&&o.context===n){r.splice(i,1);break}}0===r.length&&delete this.mapListeners[t]}},n.prototype.removeAllListener=function(t){this.mapListeners.hasOwnProperty(t)&&delete this.mapListeners[t]},n.prototype.dispatchWith=function(e,n){this.dispatchEvent(new t.Event(e,n))},n.prototype.dispatchEvent=function(t){var e=this.mapListeners[t.eventType];e&&e.forEach(function(e){return e.handle.call(e.context,t)})},n.prototype.hasEventListener=function(t,e,n){var r=this.mapListeners[t];return r&&r.some(function(t){return t.handle===e&&t.context===n})},n}(t.HashObject);t.EventDispatcher=e,__reflect(e.prototype,"rce.EventDispatcher")}(rce||(rce={}));var rce;!function(t){var e=function(t){function e(e,n){var r=t.call(this)||this;return r.eventType=e,r.data=n,r}return __extends(e,t),e}(t.HashObject);t.Event=e,__reflect(e.prototype,"rce.Event")}(rce||(rce={}));var rce;!function(t){function e(e){switch(e){case"Vue":return new t.VuePlugin;default:throw new Error("插件类型无效："+e+"!")}}var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.sendNotice=function(e,r,i,o){n.dispatchEvent(new t.Notice(e,r,i,o))},n.listenBroadcast=function(t,e,i){n.dispatchEvent(new r({broadcastType:t,handle:e,context:i}))},n}return __extends(n,e),n}(t.EventDispatcher);t.Plugin=n,__reflect(n.prototype,"rce.Plugin");var r=function(t){function e(n){return t.call(this,e.LISTEN_BROADCAST,n)||this}return __extends(e,t),e.LISTEN_BROADCAST="add_broadcast_listener",e}(t.Event);t.PluginEvent=r,__reflect(r.prototype,"rce.PluginEvent"),t.getPlugin=e}(rce||(rce={}));var rce;!function(t){var e=function(t){function e(n,r){var i=t.call(this,e.EVENT,r)||this;return i.broadcastType=n,i}return __extends(e,t),e.EVENT="SYSTEM.EVENT.BROADCAST",e}(t.Event);t.Broadcast=e,__reflect(e.prototype,"rce.Broadcast")}(rce||(rce={}));var rce;!function(t){var e=function(t){function e(n,r,i,o){var c=t.call(this,e.EVENT,r)||this;return c.noticeType=n,c.whileDone=i,c.context=o,c}return __extends(e,t),e.EVENT="SYSTEM.EVENT.NOTICE",e}(t.Event);t.Notice=e,__reflect(e.prototype,"rce.Notice")}(rce||(rce={}));var rce;!function(t){var e;!function(t){function e(t,e){var n=Date.now();e(function(){console.log("notice "+t.noticeType+" cost "+(Date.now()-n)+" ms")})}t.Log=e}(e=t.middleware||(t.middleware={}))}(rce||(rce={}));var rce;!function(t){function e(){return"rce_frame_v_"+n}var n="0.1.0";t.version=e}(rce||(rce={}));var rce;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.install=function(t){var e=this.sendNotice.bind(this),n=this.listenBroadcast.bind(this);t.mixin({beforeCreate:function(){this.__sn=this.$sendNotice=e,this.__lb=this.$listenBroadcast=n}}),t.prototype.__sn=t.prototype.$sendNotice=e,t.prototype.__lb=t.prototype.$listenBroadcast=n},e}(t.Plugin);t.VuePlugin=e,__reflect(e.prototype,"rce.VuePlugin")}(rce||(rce={}));var rce;!function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.__noticeListeneres=[],n.listenNotice=function(t,e,r){n.__noticeListeneres.push({noticeType:t,handle:e,context:r})},n.__broadcastListeneres=[],n.listenBroadcast=function(t,e,r){n.__broadcastListeneres.push({broadcastType:t,handle:e,context:r})},n.sendNotice=function(e,r,i,o){n.dispatchEvent(new t.Notice(e,r,i,o))},n.sendBroadcast=function(e,r){n.dispatchEvent(new t.Broadcast(e,r))},n.__beforeAppStart=function(t){t.__addNoticeListener.apply(t,n.__noticeListeneres),t.__addBroadcastListener.apply(t,n.__broadcastListeneres)},n.__ln=n.listenNotice,n.__sn=n.sendNotice,n.__sb=n.sendBroadcast,n.__lb=n.listenBroadcast,n}return __extends(n,e),n}(t.EventDispatcher);t.Service=e,__reflect(e.prototype,"rce.Service")}(rce||(rce={}));var rce;!function(t){function e(t,e,n){i.addEventListener(t,e,n)}function n(t,e,n){i.removeEventListener(t,e,n)}function r(t,e){i.dispatchWith(t,e)}var i=new t.EventDispatcher;t.addAction=e,t.removeAction=n,t.doAction=r}(rce||(rce={}));var rce;!function(t){function e(t,e,n,r){var i=window.__extends,o=window.__reflect,c=function(e){function n(){return Array.prototype.unshift.call(arguments,o?o.bind(this):null),t.apply(this,arguments),this}e&&i(n,e);var o=e?function(){var t=null!==e&&e.apply(this,arguments)||this;return t}:null;return r&&r(n.prototype),n}(e);return o(c.prototype,n),c}t.extend=e}(rce||(rce={}));var rce;!function(t){function e(){}t.noop=e}(rce||(rce={}));var rce;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._serviceArr=[],t._arrMiddleware=[],t._mapNoticeListener={},t._mapBroadcastListener={},t}return __extends(n,e),n.prototype.useService=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(n=this._serviceArr).push.apply(n,t);var n},n.prototype.useMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(n=this._arrMiddleware).push.apply(n,t);var n},n.prototype.start=function(){var e=this;return this._serviceArr.forEach(function(n){n.__beforeAppStart(e),n.addEventListener(t.Notice.EVENT,e.receiveNotice,e),n.addEventListener(t.Broadcast.EVENT,e.receiveBroadcast,e)}),Promise.resolve()},n.prototype.__addNoticeListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t.length;r>n;n+=1){var i=t[n],o=i.noticeType;if(this._mapNoticeListener[o])throw new Error("每个特定的Notice类型消息只能存在唯一一个监听器: "+o);this._mapNoticeListener[o]=i}},n.prototype.receiveNotice=function(t){var e=t.noticeType,n=this._mapNoticeListener[e];return n?void this.noticeAssemblyLine(t,n):void console.warn("未处理的通知: "+e+"！请检查 Notice 事件监听，并确保已调用 App 实例的 start() 方法")},n.prototype.noticeAssemblyLine=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,c,a,s,u;return __generator(this,function(p){switch(p.label){case 0:for(n=[],r=function(t){return t&&n.push(t)},i=0,o=this._arrMiddleware.length;o>i;i+=1)if(c=this._arrMiddleware[i](t,r))return[2];a=null,s=null,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,e.handle.call(e.context,t)];case 2:return s=p.sent(),[3,4];case 3:return u=p.sent(),a=u,[3,4];case 4:for(;n.length;)n.pop()(a,s);return t.whileDone&&t.whileDone.call(t.context,a,s),[2]}})})},n.prototype.__addBroadcastListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t.length;r>n;n+=1){var i=t[n],o=i.broadcastType,c=this._mapBroadcastListener[o];c?c.push(i):this._mapBroadcastListener[o]=[i]}},n.prototype.receiveBroadcast=function(t){var e=t.broadcastType,n=this._mapBroadcastListener[e];return n?void n.forEach(function(e){return e.handle.call(e.context,t)}):void console.warn("未处理的广播: "+e+"！请检查广播监听，并确保已调用 App 实例的 start() 方法")},n.prototype.viewPlugin=function(e){var n=this;return this._viewPlugin||(this._viewPlugin=t.getPlugin(e),this._viewPlugin.addEventListener(t.Notice.EVENT,this.receiveNotice,this),this._viewPlugin.addEventListener(t.PluginEvent.LISTEN_BROADCAST,function(t){n.__addBroadcastListener(t.data)})),this._viewPlugin},n}(t.HashObject);t.App=e,__reflect(e.prototype,"rce.App")}(rce||(rce={}));